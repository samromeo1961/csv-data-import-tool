# User Guide: zzTakeoff Import Converter

## Overview

This application converts estimating software exports into zzTakeoff import format using AI to intelligently map fields.

## What Gets Mapped

### Source Fields (from your export)
- Databuild Code → SKU
- Name → Name & Description  
- Unit Price → Cost Each
- Units → Units
- Quantity → Used for AI analysis
- Supplier Reference → Helps determine Cost Type

### Target Fields (for zzTakeoff)
Generated by AI:
- **Cost Type**: Material, Labor, Equipment, Subcontract, Other
- **Takeoff Type**: Area, Linear, Count, Segment
- **Formula**: Based on takeoff type and item characteristics

Mapped directly:
- **Name**: From source description
- **SKU**: From source code
- **Cost Each**: From source unit price
- **Units**: From source units

## Step-by-Step Walkthrough

### Step 1: Prepare Your Export

Export from your estimating software (Databuild, PlanSwift, Bluebeam, etc.) to CSV or Excel.

**Recommended columns to include:**
- Item description/name
- Quantity  
- Unit of measure
- Unit price/cost
- Item code/SKU
- Supplier/subcontractor reference

**Example Export:**
```
Code    | Name                  | Quantity | Units | Price | Supplier
--------|-----------------------|----------|-------|-------|----------
130 010 | Internal Drainage     | 15       | EA    | 70    | RAVPLUMB
180 030 | Supply 32MPA Concrete | 10       | CU M  | 237   |
360004  | Install R3.0 batts    | 188.64   | Sm    | 5.25  | PATNICAR
```

### Step 2: Load File

1. Click **"Load CSV/Excel"** button
2. Browse to your export file
3. Select and open

**What happens:**
- File is loaded into memory
- Data is displayed in the preview table
- "Generate Cost Types" button becomes active

**Preview shows:**
- All columns from your source file
- First 100 rows for quick review

### Step 3: Generate Cost Types

Click **"Generate Cost Types (AI)"**

**AI analyzes:**
- Item descriptions for keywords (supply, install, fix)
- Supplier references (plumber names, contractor codes)
- Context clues from the full item description

**AI classifies as:**

| Cost Type | Examples |
|-----------|----------|
| Material | "Supply Face Bricks", "Cement 20kg", "Caesarstone benchtop" |
| Labor | "Install batts", "Fix tiles", "Paint rendered brickwork" |
| Subcontract | Items with supplier references like RAVPLUMB, MINHQUAN |
| Equipment | "Hire scaffolding", "Crane rental" |
| Other | Miscellaneous or unclear items |

**Example Results:**
```
Name                           → Cost Type
-----------------------------------------
Internal Drainage Points       → Subcontract (has RAVPLUMB supplier)
Supply 32MPA Concrete          → Material ("Supply" keyword)
Install R3.0 batts             → Subcontract (has PATNICAR supplier)
Fix tiles                      → Labor ("Fix" keyword)
Rough-In Shower                → Labor (plumbing work)
```

### Step 4: Generate Takeoff Types

Click **"Generate Takeoff Types (AI)"**

**AI analyzes:**
- Unit of measure primarily
- Item descriptions for context
- Quantity types

**AI classifies as:**

| Takeoff Type | Unit Examples | Item Examples |
|--------------|---------------|---------------|
| Area | SM, Sm, m2, SQ M, SQM | Floor tiles, ceiling insulation, wall rendering |
| Linear | M, Lm, LM, metres | Downpipes, cornices, timber lengths |
| Count | EA, THOUS, bag, TONNE | Drainage points, doors, cement bags |
| Segment | (special linear) | Segmented items |

**Example Results:**
```
Name                     | Units | → Takeoff Type
-------------------------------------------------
Internal Drainage Points | EA    | → Count
Supply Concrete          | CU M  | → Count
Install batts            | Sm    | → Area
Downpipes               | EA    | → Count
Cornice                 | M     | → Linear
```

### Step 5: Generate Formulas

Click **"Generate Formulas (AI)"**

**AI generates formulas based on takeoff type:**

| Takeoff Type | Common Formulas | When Used |
|--------------|-----------------|-----------|
| Area | "Area" | Single area measurement |
| Area | "Length * Width" | Calculated from dimensions |
| Linear | "Length" | Single linear measurement |
| Linear | "Count * Length" | Multiple pieces of same length |
| Count | "Count" | Simple counting |
| Count | "Quantity" | From quantity field |

**Example Results:**
```
Name                     | Takeoff Type | → Formula
-------------------------------------------------------
Internal Drainage Points | Count        | → Count
Install batts (ceiling)  | Area         | → Area
Downpipes               | Count        | → Count
Cornice                 | Linear       | → Length
Face Bricks             | Count        | → Count
```

### Step 6: Review Results

Before exporting, review the preview table:

**Check for:**
- ✓ All Cost Types are reasonable
- ✓ Takeoff Types match the units
- ✓ Formulas are appropriate
- ✓ Required fields are populated

**Common patterns to verify:**
- Supply items → Material
- Install/Fix items → Labor
- Items with supplier names → Subcontract
- SM/m2 items → Area takeoff type
- EA items → Count takeoff type
- M/Lm items → Linear takeoff type

### Step 7: Export

Click **"Export to zzTakeoff"**

1. Choose save location
2. Enter filename
3. Select format (CSV recommended)
4. Click Save

**Output file includes:**
```
Cost Type | Name | Usage | Takeoff Type | Formula | Waste % | Round Up | SKU | Description | Cost Each | Markup % | Units
```

All required fields (marked with * in zzTakeoff) are populated.

### Step 8: Import to zzTakeoff

1. Open zzTakeoff
2. Go to Import section
3. Select "Batch Insert Item Templates"
4. Choose your exported file
5. Map columns if needed (should auto-map)
6. Import

## Understanding AI Decisions

### Cost Type Logic

**Material indicators:**
- Keywords: supply, provide, deliver
- No supplier reference
- Raw materials: bricks, cement, sand

**Labor indicators:**
- Keywords: install, fix, paint, render, lay
- Work descriptions
- May have supplier if subcontracted

**Subcontract indicators:**
- Supplier reference present (RAVPLUMB, MINHQUAN)
- Contractor names
- Trade-specific work

**Equipment indicators:**
- Keywords: hire, rental, crane
- Temporary items

### Takeoff Type Logic

**Determined primarily by units:**
- SM, Sm, m2 → Area
- M, Lm, LM → Linear
- EA, each → Count
- THOUS, bags, tonnes → Count

**Context helps refine:**
- "Floor tiles" in SM → Area
- "Timber 5.4m" → Linear
- "Doors" in EA → Count

### Formula Logic

**Simple mapping:**
- Area type → "Area" formula
- Linear type → "Length" formula  
- Count type → "Count" formula

**More complex:**
- Multiple pieces → "Count * Length"
- Calculated areas → "Length * Width"
- With waste → "(Area) * (1 + Waste/100)"

## Tips for Best Results

### Before You Start

1. **Clean your export**
   - Remove blank rows
   - Ensure consistent units
   - Fix obvious typos

2. **Use descriptive names**
   - "Supply and install R3.0 batts" better than "Batts"
   - Include key details in descriptions

3. **Include supplier info**
   - Helps AI identify subcontract work
   - Improves Labor vs Subcontract accuracy

### During Processing

1. **Process in batches**
   - Start with 20-50 items
   - Review results
   - Process full file once satisfied

2. **Check the preview**
   - Review a few items from each category
   - Verify classifications make sense

3. **Look for patterns**
   - If one item is wrong, similar items might be too
   - Check all items with same supplier
   - Verify all items with same units

### After Export

1. **Spot check the CSV**
   - Open in Excel before importing
   - Verify required fields are populated
   - Check a few formulas

2. **Test import with subset**
   - Import 5-10 items first
   - Verify they work in zzTakeoff
   - Then import the full file

3. **Keep your mapping history**
   - The app saves patterns in `mapping_history.json`
   - Don't delete this file
   - It improves accuracy over time

## Troubleshooting Classifications

### Cost Types Wrong

**Issue**: Materials classified as Labor
**Fix**: Check if description has "install/fix" - remove or rephrase

**Issue**: Labor classified as Subcontract  
**Fix**: AI uses supplier reference - if supplier present, assumes subcontract

**Issue**: Everything is "Other"
**Fix**: Descriptions may be too vague - add more detail

### Takeoff Types Wrong

**Issue**: Count items marked as Area
**Fix**: Check units - EA should never be Area

**Issue**: Area items marked as Count
**Fix**: Check units - SM/m2 should always be Area

### Formulas Don't Make Sense

**Issue**: Count items have "Area" formula
**Fix**: This shouldn't happen - report as bug

**Issue**: Need more complex formula
**Fix**: Edit the exported CSV manually before importing

## Common Source File Formats

### Databuild Export
```
Databuild Code | Quantity | Name | Unit Price | Units | Supplier Reference
```
**Works perfectly** - all fields recognized

### PlanSwift Export
```
Item | Description | Quantity | Unit | Rate
```
**Works well** - may need to add supplier column manually

### Bluebeam Export
```
Label | Length | Area | Count | Type
```
**Works with adjustment** - combine fields as needed

### Price List
```
Code | Description | Unit | Price
```
**Basic support** - add quantity column if possible

## Advanced Features

### Mapping History

File: `mapping_history.json`

Stores learned patterns:
- Keywords that indicate Material
- Suppliers that indicate Subcontract
- Units that map to Takeoff Types

**Improves over time** as you process more files.

**To reset learning:** Delete this file

### Batch Processing

For multiple similar files:
1. Process first file completely
2. Process subsequent files
3. AI learns from patterns
4. Accuracy improves

### Custom Modifications

Edit `takeoff_converter.py` to:
- Adjust AI prompts
- Add custom classification rules
- Modify formula generation
- Add validation checks

## Example: Complete Workflow

**Starting file:** Databuild export with 150 items

1. **Load**: `databuild_project123.csv`
   - 150 rows loaded ✓
   
2. **Generate Cost Types**
   - 50 items → Material
   - 60 items → Labor  
   - 35 items → Subcontract
   - 5 items → Other
   - Review: Looks good ✓

3. **Generate Takeoff Types**
   - 75 items → Count (EA, THOUS, bags)
   - 50 items → Area (SM, m2)
   - 25 items → Linear (M, Lm)
   - Review: All correct ✓

4. **Generate Formulas**
   - Count items → "Count"
   - Area items → "Area"
   - Linear items → "Length"
   - Review: Appropriate ✓

5. **Export**
   - Saved as: `project123_zztakeoff.csv`
   - All 150 items ready ✓

6. **Import to zzTakeoff**
   - Test with 10 items first ✓
   - Import all 150 items ✓
   - Success! ✓

**Time saved:** Manual entry would take hours; this took 5 minutes!

---

## Support & Feedback

For questions or issues:
1. Check QUICKSTART.md for setup
2. Check README.md for details
3. Review this guide for usage
4. Check your API key and credits

**Version:** 1.0.0
